<!DOCTYPE html 
	  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  
  <head>
    <title>JBrowse</title>
    <link rel="stylesheet" type="text/css" href="jslib/dijit/themes/tundra/tundra.css"></link>
    <link rel="stylesheet" type="text/css" href="jslib/dojo/resources/dojo.css"></link>
    <link rel="stylesheet" type="text/css" href="genome.css"></link>
    <style type="text/css">
      html, body { height: 100%; width: 100%; padding: 0; border: 0; }
    </style>

    <script type="text/javascript" src="jslib/dojo/dojo.js" djConfig="isDebug: false"></script>
    <script type="text/javascript" src="jslib/dojo/jbrowse_dojo.js" ></script>

    <script type="text/javascript" src="js/Browser.js"></script>
    <script type="text/javascript" src="js/Util.js"></script>
    <script type="text/javascript" src="js/NCList.js"></script>
    <script type="text/javascript" src="js/LazyPatricia.js"></script>
    <script type="text/javascript" src="js/LazyArray.js"></script>
    <script type="text/javascript" src="js/Track.js"></script>
    <script type="text/javascript" src="js/SequenceTrack.js"></script>
    <script type="text/javascript" src="js/Layout.js"></script>
    <script type="text/javascript" src="js/FeatureTrack.js"></script>
    <script type="text/javascript" src="js/UITracks.js"></script>
    <script type="text/javascript" src="js/ImageTrack.js"></script>
    <script type="text/javascript" src="js/GenomeView.js"></script>
    <script type="text/javascript" src="data/refSeqs.js"></script>
    <script type="text/javascript" src="data/trackInfo.js"></script>

    <script type="text/javascript">
    /* <![CDATA[ */

    //var jsyn = new JBrowseSyn(dojo.byId("jsyn"));
    //jsyn.setTaxonOrder(["species1", "species2"]);

    dojo.addOnLoad(
        function(num) {

           var refSeq = refSeqs[21];

           var gv = new Array();
           var viewDndWidget = new Array();
           var trackCreate = new Array();

           var numSeqs = 7;
           var percent = 100 / numSeqs;
           var cont = dojo.byId("jsyn");

           for (var i=0;i<numSeqs;i=i+1) {
 
           var e = document.createElement("div");
           e.id = "species" + i;
           e.style.top = (i * percent) +  "%";
           e.style.height = percent + "%";
           e.style.width = "100%";
           e.setAttribute("class","dragWindow");
           e.style.position="absolute";
           cont.appendChild(e);

           gv[i] = new GenomeView(e, 250, refSeq, 1/1000);

           var track = trackInfo[2];

           trackCreate[i] = function (x) {
               return function(track, hint) {
               var node;
                   var replaceData = {refseq: refSeq.name};
                   var url = track.url.replace(/\{([^}]+)\}/g, function(match, group) {return replaceData[group];});
                   var klass = eval(track.type);
                   var newTrack = new klass(track, url, refSeq,
                                            {
                                                changeCallback: function() {gv[x].showVisibleBlocks()},
                                                trackPadding: gv[x].trackPadding,
                                                baseUrl: "",
                                                charWidth: gv[x].charWidth,
                                                seqHeight: gv[x].seqHeight
                                            });
                   node = gv[x].addTrack(newTrack);

               return {node: node, data: track, type: ["track"]};
           }}(i);

           viewDndWidget[i] = new dojo.dnd.Source(gv[i].zoomContainer,
                                                    {
                                                        creator: trackCreate[i],
                                                        accept: ["track"],
                                                        withHandles: true
                                                    });


           viewDndWidget[i].insertNodes(false, [track]);
           gv[i].updateTrackList();
           gv[i].centerAtBase(20000000);

           }

        })
    /* ]]> */
    </script>
  </head>
  
  <body>
    <div id="jsyn" style="height: 80%; width: 80%; padding: 0; border: 0;"></div>
  </body>
</html>
